(()=>{"use strict";var e=document.querySelector(".profile__add-button"),t=document.getElementById("popup-add-photo"),n=document.querySelectorAll(".popup"),o=document.querySelector(".elements"),r=document.querySelector(".profile__avatar-edit"),c=document.querySelector("#popup-edit-avatar"),a=document.querySelector("#avatar-input"),i=document.querySelector("#title"),u=document.querySelector("#link"),l=document.querySelector(".profile__edit-button"),s=document.querySelector("#popup-edit-profile"),d=document.forms["edit-profile"],m=document.querySelector(".profile__name"),f=document.querySelector(".profile__about"),p=document.querySelector("#username"),_=document.querySelector("#description"),v=document.querySelector(".profile__avatar");function h(e){"Escape"===e.key&&S(document.querySelector(".popup_opened"))}function y(e){e.classList.add("popup_opened"),document.addEventListener("keydown",h)}function S(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",h)}n.forEach((function(e){e.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup_opened")||t.target.classList.contains("popup__close"))&&S(e)}))}));var b="https://mesto.nomoreparties.co/v1/plus-cohort-16",q={Authorization:"9fa4e769-1ae3-4e20-a9e0-1854bd9d5234","Content-Type":"application/json"};function E(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var g=document.querySelector("#popup-open-image"),C=document.querySelector(".popup__image"),L=document.querySelector("#card-template").content,k=document.querySelector(".popup__caption");function x(e,t){return t.some((function(t){return t._id==e}))}function A(e,t,n,o,r,c){var a=L.querySelector(".element").cloneNode(!0),i=a.querySelector(".element__image"),u=a.querySelector(".element__like-counter"),l=a.querySelector(".element__like-button"),s=a.querySelector(".element__delete-button");return u.textContent=r.length,x(o,r)&&l.classList.add("element__like-button_active"),l.addEventListener("click",(function(e){x(o,r)?function(e){return fetch("".concat(b,"/cards/likes/").concat(e),{method:"DELETE",headers:q}).then(E)}(c).then((function(t){return u.textContent=t.likes.length,e.target.classList.toggle("element__like-button_active"),r=t.likes})).catch((function(e){console.log("Что-то пошло не так. Ошибка: ".concat(e))})):function(e){return fetch("".concat(b,"/cards/likes/").concat(e),{method:"PUT",headers:q}).then(E)}(c).then((function(t){return u.textContent=t.likes.length,e.target.classList.toggle("element__like-button_active"),r=t.likes})).catch((function(e){console.log("Что-то пошло не так. Ошибка: ".concat(e))}))})),o==n?s.addEventListener("click",(function(){var e=a.closest(".element");(function(e){return fetch("".concat(b,"/cards/").concat(e),{method:"DELETE",headers:q}).then(E)})(c).then((function(t){e.remove()})).catch((function(e){console.log("Что-то пошло не так. Ошибка: ".concat(e))}))})):s.remove(),i.addEventListener("click",(function(){y(g),C.src=t,C.alt=e,k.textContent=e})),a.querySelector(".element__title").textContent=e,i.src=t,i.alt=e,a}function T(e,t){e.textContent=t?"Сохранение...":"Сохранить"}var w,B={formSelector:".popup__form",inputSelector:".popup__input",inputForm:".form__input",submitButtonSelector:".form__submit",disabledButtonClass:".form__submit_disabled",inputErrorClass:".form__input_type_error",elementErrorClass:".form__input-error"};function D(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.disabledButtonClass),t.disabled=!1):(t.classList.add(n.disabledButtonClass),t.disabled=!0)}function P(e,t,n,o){e.textContent=o.name,t.textContent=o.about,n.src=o.avatar}fetch("".concat(b,"/users/me"),{headers:q}).then(E).then((function(e){P(m,f,v,e);var t=e._id;fetch("".concat(b,"/cards"),{headers:q}).then(E).then((function(e){!function(e,t,n){t.forEach((function(t){e.prepend(A(t.name,t.link,t.owner._id,n,t.likes,t._id))}))}(o,e,t)})).catch((function(e){console.log("Что-то пошло не так. Ошибка: ".concat(e))}))})),l.addEventListener("click",(function(){y(s),p.value=m.textContent,_.value=f.textContent})),e.addEventListener("click",(function(){y(t)})),t.addEventListener("submit",(function(e){var n,r;e.preventDefault(),T(e.submitter,!0),(n=i.value,r=u.value,fetch("".concat(b,"/cards/"),{method:"POST",headers:q,body:JSON.stringify({name:n,link:r})}).then(E)).then((function(n){o.prepend(A(n.name,n.link,n.owner._id,n.owner._id,n.likes,n._id)),S(t),e.target.reset()})).catch((function(e){console.log("Что-то пошло не так. Ошибка: ".concat(e))})).finally((function(){T(e.submitter,!1)}))})),d.addEventListener("submit",(function(e){var t,n;e.preventDefault(),T(e.submitter,!0),(t=p.value,n=_.value,fetch("".concat(b,"/users/me"),{method:"PATCH",headers:q,body:JSON.stringify({name:t,about:n})}).then(E)).then((function(e){P(m,f,v,e),m.textContent=p.value,f.textContent=_.value,S(s)})).catch((function(e){console.log("Что-то пошло не так. Ошибка: ".concat(e))})).finally((function(){T(e.submitter,!1)}))})),r.addEventListener("click",(function(){y(c)})),c.addEventListener("submit",(function(e){var t;e.preventDefault(),T(e.submitter,!0),(t=a.value,fetch("".concat(b,"/users/me/avatar"),{method:"PATCH",headers:q,body:JSON.stringify({avatar:"".concat(t)})}).then(E)).then((function(t){P(v,m,f,t),S(c),v.src=t.avatar,e.target.reset()})).catch((function(e){console.log("Что-то пошло не так. Ошибка: ".concat(e))})).finally((function(){T(e.submitter,!1)}))})),w=B,Array.from(document.querySelectorAll(w.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputForm)),o=e.querySelector(t.submitButtonSelector);D(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.elementErrorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.elementErrorClass)}(e,t,t.validationMessage,n)}(e,r,t),D(n,o,t)}))}))}(e,B)}))})();